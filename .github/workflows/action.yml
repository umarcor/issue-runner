name: 'action'

on:
  push:
    tags:
      - '*'
      - '!tip'
    branches:
      - '*'

env:
  CI: true

jobs:

  action:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
    - run: yarn
    - run: yarn build
    - run: yarn test
    - run: rm -rf dist/*
    - run: yarn prod
    - name: Deploy to gha-tip
      if: endsWith(github.ref, '/master')
      run: ./.github/update_gha-tip.sh
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
